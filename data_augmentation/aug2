import os
import cv2
from PIL import Image
import numpy as np

# 이미지가 들어 있는 최상위 폴더 경로 (Google Drive 내 경로)
base_path = '/content/drive/MyDrive/Unknown2'

# 이미지 확장자 리스트
valid_exts = ['.jpg', '.jpeg', '.png', '.bmp']

# 증강된 이미지 저장 개수 카운터
augment_cnt = 1
image_cnt = 0

# 하위 폴더까지 모두 순회
for root, dirs, files in os.walk(base_path):
    for file in files:
        if os.path.splitext(file)[-1].lower() in valid_exts:
            image_cnt += 1
            image_path = os.path.join(root, file)
            print(f"📷 처리 중: {image_path}")

            image = Image.open(image_path)

            # 1. 좌우 반전
            inverted = image.transpose(Image.FLIP_LEFT_RIGHT)
            inverted.save(os.path.join(root, f'inverted_{augment_cnt}.png'))
            augment_cnt += 1

            # 2. 회전 (-20도 ~ 20도)
            rotated = image.rotate(np.random.randint(-20, 21))
            rotated.save(os.path.join(root, f'rotated_{augment_cnt}.png'))
            augment_cnt += 1

            # 3. 블러 처리
            img_cv = cv2.imread(image_path)
            if img_cv is not None:
                blurred = cv2.GaussianBlur(img_cv, (21, 21), 0)
                blurred_rgb = cv2.cvtColor(blurred, cv2.COLOR_BGR2RGB)
                blurred_image = Image.fromarray(blurred_rgb)
                blurred_image.save(os.path.join(root, f'blurred_{augment_cnt}.png'))
                augment_cnt += 1
            else:
                print(f"⚠️ 이미지 불러오기 실패: {image_path}")

print(f"\n🔍 총 이미지 파일 수: {image_cnt}")
print(f"✅ 총 {augment_cnt - 1}개의 증강 이미지가 생성되었습니다.")
